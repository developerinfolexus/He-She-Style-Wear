<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wishlist Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #007bff;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        button.danger {
            background: #dc3545;
        }

        button.danger:hover {
            background: #c82333;
        }

        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }

        .info {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸ”§ Wishlist Debug Tool</h1>

        <div class="section">
            <h3>Current Storage Keys</h3>
            <div id="storage-info"></div>
            <button onclick="showStorageKeys()">Refresh Storage Info</button>
        </div>

        <div class="section">
            <h3>Wishlist Data</h3>
            <div id="wishlist-data"></div>
            <button onclick="showWishlistData()">Show Wishlist Data</button>
        </div>

        <div class="section">
            <h3>Actions</h3>
            <button class="danger" onclick="clearGuestWishlist()">Clear Guest Wishlist (he_she_wishlist)</button>
            <button class="danger" onclick="clearAllWishlists()">Clear ALL Wishlists</button>
            <button onclick="window.location.href='/wishlist/'">Go to Wishlist Page</button>
        </div>

        <div class="section">
            <h3>Instructions</h3>
            <p class="info">
                1. Click "Show Wishlist Data" to see all wishlist keys in localStorage<br>
                2. If you see data in "he_she_wishlist" (guest key) when logged in, click "Clear Guest Wishlist"<br>
                3. Refresh the wishlist page and test again<br>
                4. If issues persist, use "Clear ALL Wishlists" to start fresh
            </p>
        </div>
    </div>

    <script>
        function showStorageKeys() {
            const info = document.getElementById('storage-info');
            const keys = Object.keys(localStorage).filter(k => k.includes('wishlist'));

            if (keys.length === 0) {
                info.innerHTML = '<p class="info">No wishlist keys found in localStorage</p>';
            } else {
                info.innerHTML = '<pre>' + JSON.stringify(keys, null, 2) + '</pre>';
            }
        }

        function showWishlistData() {
            const container = document.getElementById('wishlist-data');
            const keys = Object.keys(localStorage).filter(k => k.includes('wishlist'));

            if (keys.length === 0) {
                container.innerHTML = '<p class="info">No wishlist data found</p>';
                return;
            }

            let html = '';
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                let parsed;
                try {
                    parsed = JSON.parse(data);
                } catch (e) {
                    parsed = data;
                }

                html += `<h4>${key}</h4>`;
                html += `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                html += `<p class="info">Items count: ${Array.isArray(parsed) ? parsed.length : 'N/A'}</p>`;
            });

            container.innerHTML = html;
        }

        function clearGuestWishlist() {
            if (confirm('Are you sure you want to clear the guest wishlist (he_she_wishlist)?')) {
                localStorage.setItem('he_she_wishlist', JSON.stringify([]));
                alert('Guest wishlist cleared!');
                showWishlistData();
                showStorageKeys();
            }
        }

        function clearAllWishlists() {
            if (confirm('Are you sure you want to clear ALL wishlist data? This cannot be undone!')) {
                const keys = Object.keys(localStorage).filter(k => k.includes('wishlist'));
                keys.forEach(key => {
                    localStorage.removeItem(key);
                });
                alert('All wishlist data cleared!');
                showWishlistData();
                showStorageKeys();
            }
        }

        // Auto-load on page load
        window.onload = function () {
            showStorageKeys();
            showWishlistData();
        };
    </script>
</body>

</html>