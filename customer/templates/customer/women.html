{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HE SHE STYLES - Women's Collection</title>
  <link rel="icon" href="{% static 'customer/images/logo.png' %}" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'customer/css/index.css' %}?v=2">
  <link rel="stylesheet" href="{% static 'customer/css/women.css' %}">
  <style>
    /* --- Custom Styles for Reviews, Price Range, and Region Selector --- */

    /* Review Modal Styles (Ensure these are present either here or in a linked CSS) */
    .reviews-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1200;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .reviews-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .reviews-modal {
      background-color: var(--background-color);
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .reviews-modal-overlay.active .reviews-modal {
      transform: scale(1);
    }

    .reviews-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .reviews-modal-header h2 {
      font-family: "Playfair Display", serif;
      font-size: 1.6rem;
      margin: 0;
    }

    .close-reviews-modal {
      background: none;
      border: none;
      font-size: 2rem;
      font-weight: 300;
      color: #888;
      cursor: pointer;
      line-height: 1;
    }

    .reviews-modal-body {
      padding-top: 10px;
    }

    .reviews-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .review-card {
      background-color: #f9f9f9;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 15px;
    }

    /* Add other review card styles (.review-card-header, .review-rating, etc.) if not in women.css */
    .no-reviews-message {
      text-align: center;
      color: #888;
      padding: 20px;
      font-style: italic;
      font-size: 0.9rem;
      grid-column: 1 / -1;
    }

    .whatsapp-float {
      z-index: 1201;
    }

    @media (max-width: 600px) {
      .reviews-modal {
        padding: 20px;
      }

      .reviews-modal-header h2 {
        font-size: 1.4rem;
      }

      .reviews-grid {
        grid-template-columns: 1fr;
      }
    }


    /* --- MODIFICATION START: Price Range Filter Styles (to match kids.css) --- */
    .price-range-filter {
      display: flex;
      /* Changed from grid to flex */
      align-items: center;
      gap: 8px;
      padding: 10px 0 10px 0;
      margin-top: 10px;
      border-top: 1px dashed var(--border-color);
    }

    .price-range-filter label {
      flex-shrink: 0;
      /* Ensures label doesn't shrink */
      font-size: 0.9rem;
      white-space: normal;
      /* Removed nowrap */
    }

    .price-range-filter input[type="number"] {
      width: 100%;
      /* Changed from auto to 100% */
      padding: 6px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 0.9rem;
      -moz-appearance: textfield;
      appearance: textfield;
      min-width: 0;
      /* Removed min-width */
    }

    .price-range-filter input[type="number"]::-webkit-outer-spin-button,
    .price-range-filter input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .filter-content ul {
      padding: 5px 0 5px 0;
    }

    /* --- MODIFICATION END --- */


    /* Style for the active category circle (Ensure these are present either here or in women.css) */
    .category-circle-item a.active img {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 2px var(--secondary-color);
    }

    .category-circle-item a.active p {
      color: var(--secondary-color);
      font-weight: 600;
    }

    /* Removed .push-down rule as it seems specific to index page layout */

    /* Region Dropdown Styles (Ensure these are present either here or in a linked CSS like index.css/women.css) */
    .region-flag-selector {
      position: relative;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .selected-region {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 8px;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }

    .selected-region:hover {
      background-color: #f8f8f8;
    }

    .region-flag {
      width: 20px;
      height: auto;
      vertical-align: middle;
      border: 1px solid #ddd;
      border-radius: 2px;
    }

    .region-arrow {
      font-size: 0.7rem;
      color: #888;
      transition: transform 0.2s ease;
    }

    .region-flag-selector.active .region-arrow {
      transform: rotate(180deg);
    }

    .region-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 5px);
      right: 0;
      background-color: var(--background-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      z-index: 1150;
      min-width: 80px;
      padding: 5px 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
    }

    .region-flag-selector.active .region-dropdown {
      display: block;
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .region-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 15px;
      font-size: 0.9rem;
      color: var(--text-color);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .region-option:hover {
      background-color: #f8f8f8;
    }

    .region-option span {
      white-space: nowrap;
    }

    @media (min-width: 992px) {
      .region-flag {
        width: 24px;
      }

      .selected-region {
        padding: 6px 10px;
      }

      .region-arrow {
        font-size: 0.8rem;
      }

      .region-dropdown {
        top: calc(100% + 10px);
      }

      .region-option {
        font-size: 1rem;
        padding: 10px 18px;
      }
    }

    /* --- END REGION DROPDOWN STYLES --- */


    /* --- START OF MODIFICATION: Added container padding, adjusted sidebar/grid --- */
    .product-listing.container {
      max-width: 1500px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 15px;
      /* Added left gap */
      padding-right: 15px;
      /* Added right gap */
    }

    .filter-sidebar {
      flex-basis: 300px;
      /* Adjust filter sidebar width */
      min-width: 300px;
      /* Ensure it doesn't get too small */
      max-width: 300px;
      /* Limit max width */
      margin-right: 15px;
      /* Add a small gap between filter and grid */
    }

    .product-listing-content {
      display: flex;
      /* Ensure the filter and grid are side-by-side */
      gap: 0;
      /* Remove gap at this level */
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      /* MODIFIED: 4 columns for desktop */
      gap: 10px;
      /* Reduced gap between product cards */
      flex-grow: 1;
      /* Allow product grid to take remaining space */
    }

    .product-card {
      width: 100%;
      /* Make product cards fill their grid area */
      margin: 0 auto;
    }

    /* Adjustments for tablet */
    @media (min-width: 769px) and (max-width: 992px) {
      .filter-sidebar {
        flex-basis: 180px;
        min-width: 180px;
        max-width: 180px;
        margin-right: 10px;
      }

      .product-grid {
        grid-template-columns: repeat(3, 1fr);
        /* 3 columns for tablet */
        gap: 8px;
      }
    }

    /* Adjustments for mobile */
    @media (max-width: 768px) {
      .filter-sidebar {
        display: none;
        /* Mobile filter handles visibility */
      }

      .product-listing-content {
        flex-direction: column;
      }

      .product-grid {
        grid-template-columns: repeat(2, 1fr);
        /* MODIFIED: 2 columns for mobile */
        gap: 5px;
      }

      .product-card {
        max-width: 100%;
        /* Cards take full available width in their column */
      }
    }

    /* --- END OF MODIFICATION --- */
  </style>
</head>

<body data-header-url="{% url 'api_header' %}">
  <!-- promo bar removed; kept out of markup for now -->
  <div id="header-placeholder"></div><br>
  <div class="category-circles-container container" style="max-width: 1500px">
    <!-- <div class="category-circle-item">
      <a href="#" data-category="sarees">
        <img
          src="https://media.istockphoto.com/id/1270784869/photo/pretty-indian-young-hindu-bride-in-studio-shot.jpg?s=612x612&w=0&k=20&c=NbpI14qro1pgA0Kuq6ZmgEA9pD-1M6Si_bNSGzjZP2Q="
          alt="Saree" />
        <p>Saree</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="kurtis">
        <img
          src="https://assets2.andaazfashion.com/media/catalog/product/b/r/bridal-wear-kanchipuram-silk-grey-beige-south-indian-saree-sarv160352-1.jpg"
          alt="Kurtis" />
        <p>Kurtis</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="lehengas">
        <img src="https://studiovirupa.com/cdn/shop/files/095F4134-7894-4194-92CB-55F7A0F08071_600x.jpg?v=1709122769"
          alt="Lehenga" />
        <p>Lehenga</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="dresses">
        <img src="https://i.pinimg.com/564x/ff/7d/9d/ff7d9d9afbc5eeee5f00832a1f2f6b1d.jpg" alt="Dresses" />
        <p>Dresses</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="gowns">
        <img
          src="https://tse1.mm.bing.net/th/id/OIP.uWD2A2QVK3u2hUyfZEGJ_QHaLH?w=1000&h=1500&rs=1&pid=ImgDetMain&o=7&rm=3"
          alt="Gowns" />
        <p>Gowns</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="western">
        <img src="https://i.pinimg.com/originals/0d/b7/b6/0db7b631cdd90f6b21041c289b80c69c.jpg" alt="Western Wear" />
        <p>Western</p>
      </a>
    </div>
    <div class="category-circle-item">
      <a href="#" data-category="dupatta"> <img src="https://m.media-amazon.com/images/I/71taNBbUG3L._UL1500_.jpg"
          alt="Accessories" />
        <p>Dupatta</p>
      </a>
    </div> -->
  </div>



  <main>
    {% if not selected_subcategories %}
    <div class="main-banner-carousel">
      <div class="carousel-slide" id="carouselSlide">
        {% for banner in banners %}
        <div class="carousel-item">
          <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
          <div class="carousel-overlay">
            {% if banner.title %}<h2>{{ banner.title }}</h2>{% endif %}
            {% if banner.subtitle %}<p>{{ banner.subtitle }}</p>{% endif %}
            {% if banner.link %}
            <a class="carousel-cta" href="{{ banner.link }}">Explore Now</a>
            {% endif %}
          </div>
        </div>
        {% empty %}
        <!-- Fallback if no banners active -->
        <div class="carousel-item">
          <img src="https://i.pinimg.com/originals/8a/e4/a4/8ae4a4744a57801ba33d77b0fcba43a6.jpg"
            alt="Summer collection banner">
          <div class="carousel-overlay">
            <h2>Summer Collection</h2>
            <p>Beat the heat in style with our new summer range</p>
            <a class="carousel-cta" href="{% url 'women' %}">Explore Summer</a>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="carousel-dots" id="carouselDots"></div>
      <button class="carousel-arrow prev-arrow" id="prevArrow">&#10094;</button>
      <button class="carousel-arrow next-arrow" id="nextArrow">&#10095;</button>
    </div>
    {% endif %}

    <div class="product-listing container">
      <div class="listing-header">
        <h2>Women's Collections </h2>
      </div>

      <div class="mobile-filter-sort">
        <button><i class="fas fa-filter"></i> Filter</button>
        <select id="mobile-sort-select">
          <option value="featured">Sort: Featured</option>
          <option value="price_asc">Price: Low to High</option>
          <option value="price_desc">Price: High to Low</option>
        </select>
      </div>

      <div class="product-listing-content">

        <aside class="filter-sidebar">
          <div class="sidebar-title">FILTERS</div>

          <div class="filter-accordion-item open">
            <div class="filter-header">
              Price
              <i class="fas fa-plus"></i>
            </div>
            <div class="filter-content" style="max-height: initial;">
              <ul>
                <li><label><input type="checkbox" name="price_range" value="under_32" /> Under $32</label></li>
                <li><label><input type="checkbox" name="price_range" value="32_80" /> $32 - $80</label></li>
                <li><label><input type="checkbox" name="price_range" value="over_80" /> Over $80</label></li>
              </ul>
              <div class="price-range-filter">
                <label for="price-from">From $</label> <input type="number" id="price-from" name="price_from"
                  placeholder="Min" min="0">
                <label for="price-to">To $</label> <input type="number" id="price-to" name="price_to" placeholder="Max"
                  min="0">
              </div>
            </div>
          </div>

          <div class="filter-accordion-item open">
            <div class="filter-header">
              Sub Categories
              <i class="fas fa-plus"></i>
            </div>
            <div class="filter-content">
              <ul id="subcategories-filter-list">
                <!-- Dynamically populated by women.js -->
              </ul>
            </div>
          </div>

          {% comment %} <div class="filter-accordion-item">
            <div class="filter-header">
              Color
              <i class="fas fa-plus"></i>
            </div>
            <div class="filter-content">
              <ul>
                <li><label><input type="checkbox" name="color" value="pink" /> Pink</label></li>
                <li><label><input type="checkbox" name="color" value="blue" /> Blue</label></li>
                <li><label><input type="checkbox" name="color" value="green" /> Green</label></li>
                <li><label><input type="checkbox" name="color" value="red" /> Red</label></li>
                <li><label><input type="checkbox" name="color" value="gold" /> Gold</label></li>
                <li><label><input type="checkbox" name="color" value="yellow" /> Yellow</label></li>
                <li><label><input type="checkbox" name="color" value="black" /> Black</label></li>
                <li><label><input type="checkbox" name="color" value="white" /> White</label></li>
                <li><label><input type="checkbox" name="color" value="purple" /> Purple</label></li>
                <li><label><input type="checkbox" name="color" value="orange" /> Orange</label></li>
                <li><label><input type="checkbox" name="color" value="teal" /> Teal</label></li>
              </ul>
            </div>
          </div> {% endcomment %}

          <div class="filter-accordion-item">
            <div class="filter-header">
              Fabric
              <i class="fas fa-plus"></i>
            </div>

            <div class="filter-content">
              <ul id="fabric-filter-list">
                {% for fab in fabrics %}
                <li><label><input type="checkbox" name="fabric" value="{{ fab|lower }}" /> {{ fab }}</label></li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </aside>


        <div class="product-grid products-hidden" id="product-grid">

          {% if initial_products %}
          {% for p in initial_products %}
          <article class="product-card" data-product-id="{{ p.id }}" data-category="{{ p.category|lower }}"
            data-price="{{ p.price }}" data-fabric="{{ p.fabric|lower }}">
            <a href="/product/{{ p.id }}?img={{ p.image|urlencode }}">
              <div class="product-image-container">
                <img src="{{ p.image }}" alt="{{ p.name }}" />
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ p.name }}</h3>
                <!-- Trust-First Rating Display -->
                {% with rating_data=p.get_rating_data %}
                <div class="product-rating" style="color:#f39c12; font-size:0.85em; margin:5px 0;">
                  {% if rating_data.is_new %}
                  <span style="color:#f39c12;">⭐ {{ rating_data.rating }}/5</span>
                  <span style="color:#666; font-size:0.9em;"> · {{ rating_data.display_text }}</span>
                  {% else %}
                  <span style="color:#f39c12;">⭐ {{ rating_data.rating }}/5</span>
                  <span style="color:#666; font-size:0.9em;"> ({{ rating_data.display_text }})</span>
                  {% endif %}
                </div>
                {% endwith %}
                <p class="product-price">
                  {% if p.discount_price %}
                  <span class="original-price" style="text-decoration: line-through; color: #999; margin-right: 8px;">{{
                    p.price }}</span>
                  <span class="current-price">{{ p.discount_price }}</span>
                  {% else %}
                  <span class="current-price">{{ p.price }}</span>
                  {% endif %}
                </p>
              </div>
            </a>
          </article>
          {% endfor %}
          {% endif %}
        </div>
      </div>
    </div>
    </div>
  </main>

  {% include 'customer/footer.html' %}


  <div id="reviews-modal-overlay" class="reviews-modal-overlay">
    <div class="reviews-modal">
      <div class="reviews-modal-header">
        <h2>Customer Reviews</h2>
        <button id="close-reviews-modal" class="close-reviews-modal">&times;</button>
      </div>
      <div class="reviews-modal-body">
        <div class="reviews-grid">
        </div>
      </div>
    </div>
  </div>

  <div class="mobile-filter-overlay" id="mobile-filter-overlay"></div>
  <div class="mobile-filter-drawer" id="mobile-filter-drawer">
    <div class="mobile-filter-header">
      <h3>Filters</h3>
      <button class="close-filter-btn" id="close-filter-btn">&times;</button>
    </div>
    <div class="mobile-filter-content" id="mobile-filter-content">
    </div>
    <div class="mobile-filter-footer">
      <button class="apply-filters-btn" id="apply-filters-btn">Apply Filters</button>
    </div>
  </div>

  {% comment %} <a href="https://wa.me/17808864821" class="whatsapp-float" target="_blank"
    aria-label="Chat on WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a> {% endcomment %}

  <script>
    window.SERVER_SELECTED_SUBCATEGORIES = {{ selected_subcategories | safe }};
  </script>
  <script src="{% static 'customer/js/index.js' %}"></script>
  <script src="{% static 'customer/js/women.js' %}"></script>


  <script>
    const headerUrl = document.body.dataset.headerUrl || '/api/header/';
    fetch(headerUrl)
      .then(response => response.text())
      .then(data => {
        const headerPlaceholder = document.getElementById('header-placeholder');
        if (headerPlaceholder) {
          // Extract style tags from the header HTML and add them to document head
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = data;
          const styleTags = tempDiv.querySelectorAll('style');
          styleTags.forEach(styleTag => {
            const newStyle = document.createElement('style');
            newStyle.textContent = styleTag.textContent;
            document.head.appendChild(newStyle);
          });

          // Extract the actual header content (everything except style tags)
          const headerContent = tempDiv.innerHTML.replace(/<style[\s\S]*?<\/style>/gi, '');
          headerPlaceholder.innerHTML = headerContent;

          // Re-initialize dynamic header parts handled by index.js:
          if (typeof setupSearchFunctionality === 'function') setupSearchFunctionality();
          if (typeof setupProfileDropdown === 'function') setupProfileDropdown();
          if (typeof setupNavDropdowns === 'function') setupNavDropdowns();
          if (typeof setupRegionFlagDropdown === 'function') setupRegionFlagDropdown();
          if (typeof updateCartCount === 'function') updateCartCount();
          if (typeof updateWishlistCount === 'function') updateWishlistCount();

          // --- THIS IS THE FIX ---
          if (typeof setupMobileMenuToggle === 'function') setupMobileMenuToggle();
          if (typeof setupHoverSubcategoryNavigation === 'function') setupHoverSubcategoryNavigation();
          // --- END FIX ---

          // Re-set active nav link based on current page
          const navLinks = document.querySelectorAll(".main-nav li");
          const currentPath = window.location.pathname.split('/').pop();
          navLinks.forEach(link => {
            const anchor = link.querySelector('a');
            if (anchor) {
              const href = anchor.getAttribute('href');
              link.classList.remove('active'); // Remove active from all first
              // Specifically activate the WOMEN link
              if (href === 'women.html') {
                link.classList.add('active');
              }
            }
          });
        } else {
          console.error('Header placeholder element not found.');
        }
      })
      .catch(error => console.error('Error loading header:', error));
  </script>
</body>

</html>